=== ВИРТУАЛЬНАЯ ПАМЯТЬ - ОСНОВНОЕ ===

ЧТО ТАКОЕ ВИРТУАЛЬНАЯ ПАМЯТЬ?
- Абстракция, которая дает каждому процессу собственное адресное пространство
- Процесс "думает", что у него есть вся память компьютера
- Физическая память разделяется между процессами

ОСНОВНЫЕ ПРИНЦИПЫ:
1. Каждый процесс имеет свое виртуальное адресное пространство
2. Виртуальные адреса преобразуются в физические через MMU (Memory Management Unit)
3. Память разделена на страницы (обычно 4KB)
4. Неиспользуемые страницы могут быть выгружены на диск (swap)

СТРУКТУРА ПАМЯТИ ПРОЦЕССА:

ВИРТУАЛЬНОЕ АДРЕСНОЕ ПРОСТРАНСТВО:
0x00000000 ┌─────────────────┐
           │     Текст       │ - Код программы (read-only)
           │    (Code)       │
0x08048000 ├─────────────────┤
           │    Данные       │ - Глобальные переменные
           │    (Data)       │
0x0804C000 ├─────────────────┤
           │      BSS        │ - Неинициализированные глобальные
           │                 │
0x0804D000 ├─────────────────┤
           │     Куча        │ - Динамическая память (malloc)
           │    (Heap)       │ - Растет вверх ↑
           │                 │
           ├─────────────────┤
           │                 │
           │    Свободно     │
           │                 │
           ├─────────────────┤
           │     Стек        │ - Локальные переменные
           │    (Stack)      │ - Растет вниз ↓
0xBFFFFFFF └─────────────────┘

КЛЮЧЕВЫЕ СЕГМЕНТЫ:

1. ТЕКСТ (Code):
   - Исполняемые инструкции программы
   - Только для чтения
   - Разделяется между копиями программы

2. ДАННЫЕ (Data):
   - Инициализированные глобальные и статические переменные
   - Например: int global_var = 42;

3. BSS:
   - Неинициализированные глобальные и статические переменные
   - При запуске заполняется нулями
   - Например: char buffer[1000];

4. КУЧА (Heap):
   - Динамическая память (malloc, calloc, realloc)
   - Растет в сторону увеличения адресов
   - Управляется программистом

5. СТЕК (Stack):
   - Локальные переменные функций
   - Аргументы функций
   - Возвращаемые адреса
   - Растет в сторону уменьшения адресов

ПРЕИМУЩЕСТВА ВИРТУАЛЬНОЙ ПАМЯТИ:

1. ИЗОЛЯЦИЯ ПРОЦЕССОВ:
   - Процессы не могут мешать друг другу
   - Ошибка в одном процессе не влияет на другие

2. БЕЗОПАСНОСТЬ:
   - Процесс не может получить доступ к памяти других процессов
   - Защита системной памяти

3. ОПТИМИЗАЦИЯ ПАМЯТИ:
   - Выгрузка неиспользуемых страниц на диск (swap)
   - Разделение кода между процессами

4. УПРОЩЕНИЕ ПРОГРАММИРОВАНИЯ:
   - Программист работает с линейным адресным пространством
   - Не нужно думать о физической памяти

ПРЕОБРАЗОВАНИЕ АДРЕСОВ:

ВИРТУАЛЬНЫЙ АДРЕС → ФИЗИЧЕСКИЙ АДРЕС
    │
    ↓ через MMU и таблицы страниц
    ↓
ФИЗИЧЕСКАЯ ПАМЯТЬ / SWAP

ТИПИЧНЫЕ ПРОБЛЕМЫ:

1. SEGMENTATION FAULT:
   - Попытка доступа к несуществующей памяти
   - Попытка записи в read-only память

2. OUT OF MEMORY:
   - Исчерпана виртуальная память
   - Исчерпана физическая память + swap

3. MEMORY LEAK:
   - Программа выделяет память, но не освобождает
   - Постепенно исчерпывает доступную память

КОМАНДЫ ДЛЯ АНАЛИЗА ПАМЯТИ:

# Статистика памяти процесса
pmap PID

# Карта памяти процесса
cat /proc/PID/maps

# Статус памяти процесса
cat /proc/PID/status

# Общая статистика памяти
free -h
cat /proc/meminfo

ПРИМЕР ПРОГРАММЫ ДЛЯ АНАЛИЗА ПАМЯТИ:

#include <stdio.h>
#include <stdlib.h>

int global_init = 42;          // Data сегмент
int global_uninit;             // BSS сегмент

int main() {
    int local_var;             // Стек
    char *heap_ptr;            // Указатель в стеке
    
    heap_ptr = malloc(1000);   // Память в куче
    
    printf("Глобальная инициализированная: %p\n", &global_init);
    printf("Глобальная неинициализированная: %p\n", &global_uninit);
    printf("Локальная переменная: %p\n", &local_var);
    printf("Указатель на кучу: %p\n", &heap_ptr);
    printf("Память в куче: %p\n", heap_ptr);
    printf("Функция main: %p\n", main);
    
    free(heap_ptr);
    return 0;
}